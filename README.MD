# FIAP Payment Service 

MicroserviÃ§o responsÃ¡vel por gerenciar pagamentos no ecossistema da plataforma de revenda de veÃ­culos.

---

## ğŸš€ Tecnologias

- **Python 3.12**
- **FastAPI**
- **SQLAlchemy**
- **Alembic**
- **PostgreSQL**
- **Docker / Docker Compose**

---

## âš™ï¸ Como rodar

### PrÃ©-requisitos
- Docker e Docker Compose instalados

### Passos
```bash
# Subir containers
sudo docker compose up -d --build

# Rodar migrations
sudo docker compose exec fiap-srv-payment alembic upgrade head
```

---

## ğŸ“¡ Endpoints

### Health

- **GET** `/healthz`  
  Retorna o status bÃ¡sico da aplicaÃ§Ã£o.

  **Response:**
  ```json
  {
    "status": "ok"
  }
  ```

- **GET** `/readyz`  
  Verifica a conexÃ£o com o banco de dados.

  **Response:**
  ```json
  {
    "status": "ok"
  }
  ```

---

### Payments

#### Criar pagamento
- **POST** `/payments`

  **Body:**
  ```json
  {
    "buyer_id": "uuid",
    "vehicle_id": "uuid",
    "amount": 50000.0
  }
  ```

  **Response:**
  ```json
  {
    "id": "uuid",
    "buyer_id": "uuid",
    "vehicle_id": "uuid",
    "amount": 50000.0,
    "status": "PENDING"
  }
  ```

---

#### Listar pagamentos
- **GET** `/payments`

  **Query params (opcional):**
  - `status`: `PENDING | APPROVED | REJECTED`

  **Response:**
  ```json
  [
    {
      "id": "uuid",
      "buyer_id": "uuid",
      "vehicle_id": "uuid",
      "amount": 50000.0,
      "status": "PENDING"
    }
  ]
  ```

---

#### Buscar pagamento por ID
- **GET** `/payments/{payment_id}`

  **Response:**
  ```json
  {
    "id": "uuid",
    "buyer_id": "uuid",
    "vehicle_id": "uuid",
    "amount": 50000.0,
    "status": "PENDING"
  }
  ```

---

#### Atualizar status do pagamento
- **PATCH** `/payments/{payment_id}`

  **Body:**
  ```json
  {
    "status": "APPROVED"
  }
  ```

  **Response:**
  ```json
  {
    "id": "uuid",
    "buyer_id": "uuid",
    "vehicle_id": "uuid",
    "amount": 50000.0,
    "status": "APPROVED"
  }
  ```

---

## ğŸ—„ï¸ Estrutura do projeto

```
fiap-srv-payment/
â”‚â”€â”€ src/
â”‚   â”œâ”€â”€ adapters/
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ http/
â”‚   â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ domain/
â”‚   â””â”€â”€ ports/
â”‚â”€â”€ migrations/
â”‚â”€â”€ tests/
â”‚â”€â”€ requirements.txt
â”‚â”€â”€ docker-compose.yml
â”‚â”€â”€ Dockerfile
â”‚â”€â”€ README.md
```

---

## ğŸ§ª Testes

O projeto inclui um script de testes automatizados via `curl`:

```bash
cd tests
chmod +x tests.sh
./tests.sh
```

---

## ğŸ“Œ Notas

- O campo `status` de um pagamento sÃ³ pode assumir os valores: `PENDING`, `APPROVED`, `REJECTED`.
- O valor de `amount` deve ser **maior que zero**.
- IDs de comprador (`buyer_id`) e veÃ­culo (`vehicle_id`) devem ser fornecidos como **UUIDs vÃ¡lidos**.
